#!/bin/bash
# Execute multiple Nmap concurrently in a process pool of size 5
#
# Usage:
# nmap-total.sh [ADDITIONAL_NMAP_OPTION ...] [HOST ...]
#
# Anything started with dash is considered as an option to be
# propagated to Nmap.

# Fail when pipe failed
# set -o pipefail

IPS=()
for IP in "$@"
do
  [[ "$IP" =~ -.* ]] && OPTIONS+=" $IP" || IPS+=("$IP")
done

RDIR=$(dirname $0)
for IP in "${IPS[@]}"
do
  BASE=${IP}
  echo "nmap -sV -A -p 1-65535 \"$IP\" $OPTIONS -oA \"${BASE}\"" 
done | $RDIR/cexec


# fikr4n 2015
